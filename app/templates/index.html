{% extends "page.html" %}

{% block content %}
<img alt="Word Cloud" src="wordcloud.png">
<h1>Agencies</h1>
    <script type="text/javascript">
        function recenter(value) {
            return (value + 0.2) / (2 * 0.2);
        }

        function clamp(value, min, max) {
            return Math.min(Math.max(value, min), max);
        }

        function getColorForValue(value) {
            if (value === 'N/A')
                return 'white';
            if (value == null)
                return '#f9fafb';

            var a = recenter(value);
            var b = (120 - 0) * a;
            var c = clamp(b, 0, 120);
            console.log(c);

            // Return a CSS HSL string
            return 'hsl(' + c + ', 100%, 50%)';
        }


        document.addEventListener("DOMContentLoaded", function () {
            var data = {{tabledata|safe}};

            document.getElementById('maintable').remove()

            function determineSmiley(value) {
                if (value > 0.1) {
                    return 'ðŸ˜Š';
                } else if (value < -0.1) {
                    return 'ðŸ˜­';
                }
                return '';
            }

            new gridjs.Grid({
                columns: [
                    "Agency Name",
                    "Credibility",
                    "Bias",
                    {
                        name: "Headline",
                        formatter: (cell) => gridjs.html(`<span>${cell} ${determineSmiley(cell)}</span>`),
                        attributes: (cell) => {
                            return {
                                style: `background-color: ${getColorForValue(cell)}; text-align: center;`
                            }
                        }
                    },
                    {
                        name: "Article",
                        formatter: (cell) => gridjs.html(`<span>${cell} ${determineSmiley(cell)}</span>`),
                        attributes: (cell) => {
                            return {
                                style: `background-color: ${getColorForValue(cell)}; text-align: center;`
                            }
                        },
                        sort: {
                            compare: (a, b) => {
                                if (a == 'N/A')
                                    return 1;
                                if (b == 'N/A')
                                    return -1;
                                if (a > b) {
                                    return 1;
                                } else if (b > a) {
                                    return -1;
                                } else {
                                    return 0;
                                }
                            }
                        }

                    }
                ],
                data: data,
                sort: true
            }).render(document.getElementById('wrapper'));
            console.log(getColorForValue(0.3));
        });
    </script>
<div id="wrapper"></div>
<table id="maintable">
    <thead>
    <tr>
        <th>Agency</th>
        <th>Credibility</th>
        <th>Bias</th>
        <th>Today's Headline Sentiment</th>
        <th>Today's Article Sentiment</th>
        <th>Agency Page</th>
    </tr>
    </thead>
    <tbody>
    {% for agency in agencies %}
    {% set sentiment = agency.todays_compound() %}
    <tr>
        <td><a href="{{ agency.name }}.html">{{ agency.name }}'s Page</a></td>
        <td>{{ agency.credibility }}</td>
        <td>{{ agency.bias }}</td>
        <td>{{ sentiment[0] | round(2) }}</td>
        {% if not agency.headline_only %}
        <td>{{ sentiment[1] | round(2)}}</td>
        {% else %}
        <td>Headline Only</td>
        {% endif %}
        <td><a href="{{ agency.url }}">{{ agency.name }}</a></td>
    </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock content %}
